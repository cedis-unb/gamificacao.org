{{/* News cards for homepage — 4 latest posts per current language */}}
{{ $sec := .Site.GetPage "section" "posts" }}
{{ $pages := cond $sec (where $sec.RegularPages "Lang" .Lang) (slice) }}
{{ $sorted := first 4 (sort $pages "Date" "desc") }}

<section class="w-full grid gap-8 sm:grid-cols-2 lg:grid-cols-4">
  {{ $now := now }}
  {{ range $sorted }}
  <a href="{{ .RelPermalink }}" class="group block">
    <div class="h-full m-2 rounded-lg bg-neutral-50 dark:bg-neutral-800/50 overflow-hidden p-6 shadow-2xl hover:shadow-[0_35px_60px_-15px_rgba(0,0,0,0.5)] transition-shadow duration-200">
      {{/* Header image (fallback to logo) */}}
      {{ $logo := resources.Get "logo.png" }}
      <div class="w-full h-32 -mt-2 -mx-2 mb-4 rounded-md bg-cover bg-center nozoom" style="background-image:url('{{ with $logo }}{{ .RelPermalink }}{{ end }}');"></div>

      <div class="flex flex-col gap-3">
        {{/* Title */}}
        <h3 class="text-lg font-semibold text-neutral-900 dark:text-neutral group-hover:underline group-hover:decoration-primary-500 group-hover:underline-offset-2">{{ .Title | emojify }}</h3>

        {{/* Meta: date and optional event date */}}
        <div class="text-xs text-neutral-500 dark:text-neutral-400 flex items-center gap-2">
          {{/* New badge for posts newer than 15 days */}}
          {{ $age := sub $now.Unix .Date.Unix }}
          {{ if lt $age (mul 15 24 60 60) }}
            <span class="inline-flex items-center rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide">{{ if eq $.Lang "pt" }}Novo{{ else }}New{{ end }}</span>
            <span class="px-1 text-primary-500">•</span>
          {{ end }}
          {{ $date := .Date }}
          {{ $dateStr := cond (eq $.Lang "pt") ($date.Format "02/01/2006") ($date.Format "Jan 2, 2006") }}
          <span>{{ $dateStr }}</span>
          {{ with .Params.eventDate }}
            {{ $ev := time . }}
            {{ $evStr := cond (eq $.Lang "pt") ($ev.Format "02/01/2006") ($ev.Format "Jan 2, 2006") }}
            <span class="px-1 text-primary-500">•</span>
            <span class="inline-flex items-center gap-1">
              {{ partial "icon.html" "calendar" }}
              <span>{{ if eq $.Lang "pt" }}Evento:{{ else }}Event:{{ end }} {{ $evStr }}</span>
            </span>
          {{ end }}
        </div>

        {{/* Summary (trimmed) */}}
        {{ $sum := .Summary | plainify }}
        {{ if eq (len $sum) 0 }}
          {{ $sum = cond (ne (len .Params.description) 0) .Params.description (.Plain | plainify) }}
        {{ end }}
        <p class="text-sm text-neutral-700 dark:text-neutral-300 min-h-[3.5rem]">{{ $sum | truncate 160 }}</p>

        {{/* Footer: first tag + CTA */}}
        <div class="mt-auto flex items-center justify-between">
          <div class="flex flex-wrap gap-2">
            {{ with index .Params.tags 0 }}
              <span class="inline-flex items-center rounded-full bg-neutral-200 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-200 px-2 py-0.5 text-xs">{{ . }}</span>
            {{ end }}
          </div>
          <span class="text-sm font-medium text-primary-600 dark:text-primary-400 group-hover:underline">
            {{ if eq $.Lang "pt" }}Ler mais{{ else }}Read more{{ end }}
          </span>
        </div>
      </div>
    </div>
  </a>
  {{ end }}
</section>
