{{/* Custom override: always show language selector when multilingual.
     Links to translated page if available, otherwise to that language's home. */}}
{{ if hugo.IsMultilingual }}
<div>
  <div class="cursor-pointer flex items-center nested-menu">
    <span class="ltr:mr-1 rtl:ml-1">
      {{ partial "icon.html" "language" }}
    </span>
    {{/* Direct toggle: link to translation if exists; else to other language home */}}
    {{ $switch := (index .Translations 0) }}
    {{ if not $switch }}
      {{ $switch = index (where .Site.Home.AllTranslations "Lang" "!=" .Lang) 0 }}
    {{ end }}
    {{ $label := (cond (ne $switch nil) (or $switch.Site.Language.Params.displayName (upper $switch.Lang)) "EN") }}
    <a href="{{ with $switch }}{{ .RelPermalink }}{{ end }}" class="text-sm font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="{{ with $switch }}{{ .Title }}{{ end }}">
      {{ $label }}
    </a>
  </div>
  <div class="absolute menuhide">
    <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
      <div class="flex flex-col space-y-3">
        {{ $page := . }}
        {{ $home := .Site.Home }}
        {{ range .Site.Languages }}
          {{ $lang := . }}
          {{ $t := index (where $page.Translations "Lang" $lang.Lang) 0 }}
          {{ if not $t }}
            {{ $t = index (where $home.AllTranslations "Lang" $lang.Lang) 0 }}
          {{ end }}
          {{ if $t }}
          <a href="{{ $t.RelPermalink }}" class="flex items-center">
            <p class="text-sm font-sm text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="{{ $t.Title }}">
              {{ $lang.Params.displayName | emojify }}
            </p>
          </a>
          {{ else }}
          <span class="flex items-center opacity-60">
            <p class="text-sm font-sm text-gray-500" title="{{ $lang.LanguageName }}">
              {{ $lang.Params.displayName | emojify }}
            </p>
          </span>
          {{ end }}
        {{ end }}
      </div>
    </div>
  </div>
</div>
{{ end }}
